
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="../bower_components/bloombox-device/bloombox-device.html">
<link rel="import" href="../bower_components/bloombox-styles/bloombox-styles.html">


<dom-module id="bloombox-page-home">
  <template>
    <style is="custom-style" include="bloombox-styles">
      :host {
        display: block;
        padding: 20px 40px;
      }
      h1 {
        font-size: 28px;
        margin: 16px 0;
        color: #212121;
      }
      :host bloombox-device {
        margin-bottom: 20px;
        display: inline-block;
        float: left;
        margin-right: 20px;
      }
    </style>

    <!-- Device Collection -->
    <firebase-document
      log$="[[_debug]]"
      path="[[endpoint]]/devices"
      data="{{devices}}"></firebase-document>

    <h1>Active Devices</h1>

    <div class="device-list-wrap">
      <template is="dom-repeat" items="[[_toArray(devices)]]" as="device">
        <bloombox-device
          partner="[[partner]]"
          name="[[device.key]]"
          label="[[device.value.label]]"
          online="[[device.value.online]]"
          software-version="[[device.value.version]]"
          hardware-version="V1.R1"
          type="MENU"
          visibility="PRIVATE"></bloombox-device>
      </template>
    </div><!-- end .device-list-wrap -->
  </template>

  <script>
    Polymer.BloomboxPageHome = Polymer({
      is: 'bloombox-page-home',

      properties: {
        _debug: {
          type: Boolean,
          value: function() {
            return window["__debug"] || false;
          }
        },

        partner: {
          type: String,
          notify: true
        },

        endpoint: {
          type: String,
          notify: true
        },

        devices: {
          type: String,
          notify: true
        }
      },

      _toArray: function(obj) {
        return Object.keys(obj).map(function(key) {
          return {
            key: key,
            value: obj[key]
          };
        });
      },

      _defaultDeviceLabel: function(device) {
        return device.label || device.name;
      }
    });
  </script>
</dom-module>
